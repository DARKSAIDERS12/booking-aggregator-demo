# Booking Aggregator API

API —Å–µ—Ä–≤–µ—Ä-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–ª—è —Å–∏—Å—Ç–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–±—É—Å–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤.

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –¥–≤—É–º—è –≤–Ω–µ—à–Ω–∏–º–∏ API —Å–∏—Å—Ç–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
- **API 1**: GDS (Global Distribution System) 1.14.12 - SOAP API
- **API 2**: Paybilet RF Bus - REST API

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, –æ–±—ä–µ–¥–∏–Ω—è—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–±–µ–∏—Ö —Å–∏—Å—Ç–µ–º.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- üîç –ü–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É
- üìç –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏—è–º–∏ (–∑–∞–≥—Ä—É–∑–∫–∞, —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)
- üé´ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø–ª–∞—Ç–∞ –±–∏–ª–µ—Ç–æ–≤
- ‚ùå –û—Ç–º–µ–Ω–∞ –±–∏–ª–µ—Ç–æ–≤
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏ —Ä—É—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–π

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Å—Ç–∞–Ω—Ü–∏–π
- üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π –∏–∑ —Ñ–∞–π–ª–æ–≤ (CSV, Excel)
- üîó –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–π –º–µ–∂–¥—É API
- üìã –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–•–æ–ª–º—Å–∫" + "–•–æ–ª–º—Å–∫ –ñ–î")

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: Node.js + Express + TypeScript
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL + Prisma ORM
- **–ö—ç—à**: Redis
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: Joi
- **CMS**: Strapi (–¥–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏)
- **Frontend**: React + TypeScript + HeroUI

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
cp .env.example .env
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run db:migrate

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞
npm run db:generate
```

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm run build
npm start
```

## API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ endpoints:
- `GET /api/stations` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç–∞–Ω—Ü–∏–π
- `GET /api/stations/from` - —Å—Ç–∞–Ω—Ü–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- `GET /api/races` - –ø–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤
- `GET /api/race` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–π—Å–µ
- `POST /api/register` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `POST /api/payment` - –æ–ø–ª–∞—Ç–∞
- `POST /api/cancel` - –æ—Ç–º–µ–Ω–∞

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ endpoints:
- `GET /admin/stations` - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞–Ω—Ü–∏–π
- `POST /admin/stations/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- `POST /admin/stations/load-from-apis` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API
- `POST /admin/stations/auto-map` - –∞–≤—Ç–æ—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- `POST /admin/stations/manual-map` - —Ä—É—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- `POST /admin/stations/group` - —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
- `GET /admin/stations/mapped` - —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ controllers/     # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
‚îú‚îÄ‚îÄ middleware/      # Middleware (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
‚îú‚îÄ‚îÄ routes/          # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îú‚îÄ‚îÄ types/           # TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ utils/           # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ app.ts           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ index.ts         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞

prisma/
‚îî‚îÄ‚îÄ schema.prisma    # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

admin/               # Strapi CMS (–∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å)
frontend/            # React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API

### API 1 (GDS):
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: SOAP
- **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**: getDispatchPoints, getArrivalPoints, getRaces, getRace
- **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: XML

### API 2 (Paybilet):
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: REST
- **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**: GET /stations, GET /races, POST /register
- **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: JSON

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö endpoints:
1. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤ `src/controllers/`
2. –î–æ–±–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç –≤ `src/routes/`
3. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∏–ø—ã –≤ `src/types/`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
npm test

# –õ–∏–Ω—Ç–∏–Ω–≥
npm run lint
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
